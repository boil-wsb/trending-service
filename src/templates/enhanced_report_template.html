<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¯æ—¥çƒ­é—¨æ•°æ®æŠ¥å‘Š - Trending Service</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            margin-top: 80px;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #24292e 0%, #58a6ff 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
            margin-top: 10px;
        }

        .stats-bar {
            position: fixed;
            top: 20px;
            right: 20px;
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 12px 20px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            transition: all 0.2s ease;
        }

        body.dark-mode .stats-bar {
            background: rgba(15, 15, 35, 0.95);
        }

        .stat-item {
            text-align: center;
            min-width: 80px;
        }

        .stat-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #58a6ff;
        }

        .stat-label {
            font-size: 0.8em;
            color: #586069;
            margin-top: 2px;
        }

        /* æ•°æ®æºçŠ¶æ€æ  */
        .source-status-bar {
            background: #f6f8fa;
            border-bottom: 1px solid #e1e4e8;
            padding: 15px 30px;
        }

        .source-status-title {
            font-size: 0.9em;
            font-weight: 600;
            color: #24292e;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .source-status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
        }

        .source-status-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            border-radius: 6px;
            border: 1px solid #e1e4e8;
            background: white;
            font-size: 0.85em;
            transition: all 0.2s ease;
        }

        .source-status-item.success {
            border-color: #34d058;
            background: #f0fff4;
        }

        .source-status-item.failed {
            border-color: #f97583;
            background: #ffeef0;
        }

        .source-status-item.pending {
            border-color: #ffab70;
            background: #fff8f0;
        }

        .source-status-item.unknown {
            border-color: #d1d5da;
            background: #fafbfc;
        }

        .source-status-icon {
            font-size: 1.1em;
        }

        .source-status-name {
            font-weight: 500;
            color: #24292e;
            flex: 1;
        }

        .source-status-time {
            font-size: 0.75em;
            color: #586069;
        }

        .source-status-error {
            font-size: 0.75em;
            color: #f97583;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100px;
        }

        .refresh-btn {
            padding: 4px 10px;
            border: none;
            border-radius: 4px;
            background: #0366d6;
            color: white;
            font-size: 0.75em;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
        }

        .refresh-btn:hover {
            background: #0256cc;
        }

        .refresh-btn:disabled {
            background: #959da5;
            cursor: not-allowed;
        }

        .refresh-btn.refreshing {
            background: #959da5;
            cursor: wait;
        }

        /* é€šçŸ¥æ ·å¼ */
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 0.95em;
            font-weight: 500;
            z-index: 2000;
            animation: slideDown 0.3s ease;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .notification.success {
            background: #34d058;
            color: white;
        }

        .notification.error {
            background: #f97583;
            color: white;
        }

        .notification.info {
            background: #0366d6;
            color: white;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        /* Tabæ ·å¼ */
        .tabs {
            display: flex;
            background: #f6f8fa;
            border-bottom: 2px solid #e1e4e8;
            padding: 0 20px;
            flex-wrap: wrap;
        }

        .tab {
            padding: 15px 25px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 500;
            color: #586069;
            border-bottom: 3px solid transparent;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tab:hover {
            color: #0366d6;
            background: rgba(88, 166, 255, 0.08);
        }

        .tab.active {
            color: #0366d6;
            border-bottom-color: #0366d6;
            background: white;
        }

        .tab-content {
            display: none;
            padding: 30px;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-title {
            font-size: 1.6em;
            color: #24292e;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #58a6ff;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* å…³é”®è¯é¡µé¢å¤´éƒ¨ */
        .keywords-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .keywords-header .section-title {
            margin: 0;
        }

        /* è¯äº‘å®¹å™¨ */
        .keywords-cloud {
            padding: 20px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 16px;
            height: calc(100vh - 250px);
            min-height: 500px;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        #word-cloud-canvas {
            width: 100%;
            flex: 1;
            min-height: 450px;
        }

        .word-cloud-tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.85em;
            pointer-events: none;
            z-index: 1000;
            display: none;
        }

        /* è¯äº‘æ§åˆ¶é¢æ¿ */
        .word-cloud-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: flex-end;
        }

        .word-cloud-btn {
            padding: 6px 14px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.85em;
            transition: all 0.2s ease;
        }

        .word-cloud-btn:hover, .word-cloud-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        /* å…³é”®è¯äº‘æ·±è‰²æ¨¡å¼ */
        body.dark-mode .keywords-cloud {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        }

        body.dark-mode .word-cloud-btn {
            background: #2d2d44;
            border-color: #444;
            color: #e0e0e0;
        }

        body.dark-mode .word-cloud-btn:hover, body.dark-mode .word-cloud-btn.active {
            background: #667eea;
            border-color: #667eea;
        }

        /* è¯é¢˜å¡ç‰‡ */
        .topics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .topic-card {
            background: #f6f8fa;
            border-radius: 12px;
            padding: 20px;
            border-left: 4px solid #58a6ff;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .topic-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            background: #f0f7ff;
        }

        .topic-title {
            font-size: 1.2em;
            font-weight: 600;
            color: #24292e;
            margin-bottom: 10px;
        }

        .topic-keywords {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-bottom: 15px;
        }

        .topic-keyword {
            font-size: 0.8em;
            padding: 4px 10px;
            background: #e1e4e8;
            border-radius: 12px;
            color: #586069;
        }

        .topic-items {
            margin-top: 10px;
        }

        .topic-item {
            padding: 8px 0;
            border-bottom: 1px solid #e1e4e8;
            font-size: 0.9em;
        }

        .topic-item:last-child {
            border-bottom: none;
        }

        .topic-item a {
            color: #0366d6;
            text-decoration: none;
        }

        .topic-item a:hover {
            text-decoration: underline;
        }

        /* æ•°æ®æºå¡ç‰‡ - ä¼˜åŒ–ç•™ç™½ */
        .source-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 12px;
            align-items: stretch;
        }

        .source-card {
            background: white;
            border: 1px solid #e1e4e8;
            border-radius: 10px;
            overflow: hidden;
            transition: all 0.2s ease;
            display: flex;
            flex-direction: column;
            cursor: pointer;
        }

        .source-card:hover {
            box-shadow: 0 4px 16px rgba(0,0,0,0.12);
            border-color: #58a6ff;
        }

        .source-header {
            background: linear-gradient(135deg, #f6f8fa 0%, #e1e4e8 100%);
            padding: 8px 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }

        .source-name {
            font-size: 1em;
            font-weight: 600;
            color: #24292e;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .source-count {
            background: #58a6ff;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.8em;
        }

        .source-content {
            padding: 10px 12px;
            flex: 1;
            overflow: hidden;
        }

        .item-list {
            list-style: none;
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .item-list li {
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 8px;
            flex: 1;
        }

        .item-list li:last-child {
            border-bottom: none;
            padding-bottom: 0;
        }

        .item-list li:first-child {
            padding-top: 0;
        }

        .item-rank {
            font-size: 1em;
            font-weight: bold;
            color: #58a6ff;
            min-width: 24px;
            text-align: center;
            background: #f0f7ff;
            border-radius: 4px;
            padding: 2px 6px;
            flex-shrink: 0;
        }

        .item-title {
            flex: 1;
            min-width: 0;
        }

        .item-title a {
            color: #24292e;
            text-decoration: none;
            font-weight: 600;
            font-size: 0.95em;
            line-height: 1.3;
            display: block;
            margin-bottom: 4px;
        }

        .item-title a:hover {
            color: #0366d6;
        }

        .item-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: 4px;
        }

        .meta-tag {
            font-size: 0.75em;
            padding: 2px 8px;
            background: #f6f8fa;
            color: #586069;
            border-radius: 10px;
            border: 1px solid #e1e4e8;
        }

        .item-description {
            font-size: 0.85em;
            color: #444;
            line-height: 1.5;
            margin: 6px 0;
            padding: 8px 10px;
            background: #f9fafb;
            border-left: 2px solid #58a6ff;
            border-radius: 0 4px 4px 0;
        }

        .item-keywords {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            margin-top: 4px;
        }

        .item-keyword {
            font-size: 0.7em;
            padding: 2px 8px;
            background: linear-gradient(135deg, #ddf4ff 0%, #b6e3ff 100%);
            color: #0969da;
            border-radius: 10px;
            font-weight: 500;
        }

        .item-score {
            color: #ff6b35;
            font-weight: 700;
            white-space: nowrap;
            font-size: 0.95em;
            background: linear-gradient(135deg, #fff5f0 0%, #ffe8e0 100%);
            padding: 4px 8px;
            border-radius: 6px;
            min-width: 70px;
            text-align: center;
            flex-shrink: 0;
        }

        /* ç©ºçŠ¶æ€ */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #586069;
        }

        .empty-state .emoji {
            font-size: 4em;
            margin-bottom: 20px;
        }

        /* é¡µè„š */
        .footer {
            background: #f6f8fa;
            padding: 20px;
            text-align: center;
            color: #586069;
            font-size: 0.9em;
            border-top: 1px solid #e1e4e8;
        }

        /* æš—è‰²æ¨¡å¼ */
        .dark-mode-toggle {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: #24292e;
            color: white;
            border: none;
            padding: 15px;
            border-radius: 50%;
            font-size: 1.2em;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            transition: all 0.2s ease;
            z-index: 999;
        }

        .dark-mode-toggle:hover {
            opacity: 0.9;
            box-shadow: 0 6px 20px rgba(0,0,0,0.4);
        }

        body.dark-mode {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        }

        body.dark-mode .container {
            background: #0f0f23;
            color: #e0e0e0;
        }

        body.dark-mode .tabs {
            background: #1a1a2e;
            border-bottom-color: #333;
        }

        body.dark-mode .tab {
            color: #b0b0b0;
        }

        body.dark-mode .tab.active {
            background: #0f0f23;
            color: #58a6ff;
            border-bottom-color: #58a6ff;
        }

        body.dark-mode .source-card {
            background: #1a1a2e;
            border-color: #333;
        }

        body.dark-mode .topic-card {
            background: #1a1a2e;
        }

        body.dark-mode .item-title a {
            color: #e0e0e0;
        }

        body.dark-mode .section-title {
            color: #e0e0e0;
            border-bottom-color: #58a6ff;
        }

        /* æ€»è§ˆåˆ—è¡¨ç´§å‡‘æ ·å¼ */
        .overview-list .overview-item {
            padding: 10px 0;
            min-height: auto;
        }

        .overview-list .item-description {
            display: none;
        }

        .overview-list .item-keywords {
            margin-top: 4px;
        }

        /* å¡ç‰‡å¼è®°å½•å¸ƒå±€ */
        .items-card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .item-card {
            background: white;
            border: 1px solid #e1e4e8;
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.2s ease;
            display: flex;
            flex-direction: column;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            cursor: pointer;
        }

        .item-card:hover {
            box-shadow: 0 8px 24px rgba(0,0,0,0.12);
            border-color: #58a6ff;
        }

        .item-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-bottom: 1px solid #e1e4e8;
        }

        .item-card-rank {
            font-size: 1.1em;
            font-weight: bold;
            color: #58a6ff;
            background: white;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .item-card-score {
            color: #ff6b35;
            font-weight: 700;
            font-size: 0.95em;
        }

        .item-card-body {
            padding: 16px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .item-card-title {
            font-size: 1em;
            font-weight: 600;
            color: #24292e;
            text-decoration: none;
            line-height: 1.5;
            margin-bottom: 10px;
            word-break: break-word;
        }

        .item-card-title:hover {
            color: #0366d6;
        }

        .item-card-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: 12px;
        }

        .item-card-description {
            font-size: 0.88em;
            color: #555;
            line-height: 1.7;
            margin-bottom: 12px;
            flex: 1;
            word-break: break-word;
        }

        .item-card-description.expandable {
            position: relative;
        }

        .desc-toggle {
            background: none;
            border: none;
            color: #0366d6;
            cursor: pointer;
            font-size: 0.85em;
            padding: 2px 8px;
            margin-left: 5px;
            border-radius: 4px;
            transition: background 0.2s;
        }

        .desc-toggle:hover {
            background: rgba(3, 102, 214, 0.1);
        }

        body.dark-mode .desc-toggle {
            color: #58a6ff;
        }

        body.dark-mode .desc-toggle:hover {
            background: rgba(88, 166, 255, 0.1);
        }

        .item-card-keywords {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: auto;
        }

        body.dark-mode .item-card {
            background: #1a1a2e;
            border-color: #333;
        }

        body.dark-mode .item-card-header {
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 100%);
            border-bottom-color: #333;
        }

        body.dark-mode .item-card-rank {
            background: #1a1a2e;
            color: #58a6ff;
        }

        body.dark-mode .item-card-title {
            color: #e0e0e0;
        }

        body.dark-mode .item-card-description {
            color: #aaa;
        }

        /* GitHubæœ¬å‘¨å¢é•¿æ ·å¼ */
        .github-weekly-intro {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .github-weekly-intro p {
            margin: 0;
            font-size: 1em;
        }

        .github-repo-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .github-repo-item {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: all 0.2s ease;
            border-left: 4px solid #667eea;
        }

        .github-repo-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .github-repo-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }

        .github-repo-rank {
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
            min-width: 40px;
        }

        .github-repo-info {
            flex: 1;
            margin-left: 15px;
        }

        .github-repo-name {
            font-size: 1.2em;
            font-weight: 600;
            color: #24292e;
            text-decoration: none;
            display: block;
            margin-bottom: 5px;
        }

        .github-repo-name:hover {
            color: #667eea;
        }

        .github-repo-desc {
            color: #666;
            font-size: 0.9em;
            line-height: 1.5;
        }

        .github-repo-stats {
            display: flex;
            gap: 20px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .github-repo-stat {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.85em;
            color: #555;
        }

        .github-repo-stat.growth {
            color: #e74c3c;
            font-weight: 600;
        }

        .github-repo-stat.stars {
            color: #f39c12;
        }

        .github-repo-stat.language {
            color: #3498db;
        }

        .github-repo-stat.forks {
            color: #9b59b6;
        }

        /* å›¾è¡¨æ ·å¼ */
        .chart-section {
            margin: 30px 0;
            padding: 20px;
            background: #f9fafb;
            border-radius: 12px;
        }

        .chart-section h3 {
            margin-bottom: 20px;
            color: #333;
            font-size: 1.2em;
        }

        .chart-container {
            width: 100%;
            height: 350px;
            position: relative;
        }

        /* è¶‹åŠ¿æ¦‚è§ˆå¡ç‰‡ */
        .trend-summary-cards {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin: 20px 0 30px 0;
        }

        .trend-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: all 0.2s ease;
        }

        .trend-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .trend-card-icon {
            font-size: 2em;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px;
        }

        .trend-card-info {
            flex: 1;
        }

        .trend-card-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #24292e;
        }

        .trend-card-label {
            font-size: 0.85em;
            color: #666;
            margin-top: 4px;
        }

        /* è¶‹åŠ¿åˆ†æè¯´æ˜ */
        .trend-analysis-note {
            background: #f0f4f8;
            border-radius: 12px;
            padding: 20px;
            margin-top: 30px;
        }

        .trend-analysis-note h4 {
            color: #333;
            margin-bottom: 12px;
            font-size: 1.1em;
        }

        .trend-analysis-note ul {
            list-style: none;
            padding: 0;
        }

        .trend-analysis-note li {
            padding: 8px 0;
            color: #555;
            font-size: 0.9em;
            border-bottom: 1px solid #e1e4e8;
        }

        .trend-analysis-note li:last-child {
            border-bottom: none;
        }

        .trend-analysis-note strong {
            color: #667eea;
        }

        .simple-chart {
            display: flex;
            align-items: flex-end;
            justify-content: space-around;
            height: 250px;
            padding: 20px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e1e4e8;
        }

        .chart-bar {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 60px;
        }

        .bar {
            width: 40px;
            background: linear-gradient(to top, #667eea 0%, #764ba2 100%);
            border-radius: 4px 4px 0 0;
            transition: all 0.3s;
            position: relative;
        }

        .bar:hover {
            opacity: 0.8;
            transform: scaleY(1.02);
        }

        .bar-label {
            margin-top: 8px;
            font-size: 0.8em;
            color: #666;
            text-align: center;
            max-width: 80px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .bar-value {
            position: absolute;
            top: -20px;
            font-size: 0.75em;
            color: #333;
            font-weight: 600;
        }

        .line-chart {
            position: relative;
            height: 250px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e1e4e8;
            padding: 20px;
        }

        .line-chart-svg {
            width: 100%;
            height: 100%;
        }

        body.dark-mode .chart-section {
            background: #1a1a2e;
        }

        body.dark-mode .chart-section h3 {
            color: #e0e0e0;
        }

        body.dark-mode .simple-chart,
        body.dark-mode .line-chart {
            background: #0f0f23;
            border-color: #333;
        }

        body.dark-mode .bar-label {
            color: #999;
        }

        body.dark-mode .bar-value {
            color: #e0e0e0;
        }

        /* ä»ªè¡¨ç›˜æ·±è‰²æ¨¡å¼ */
        body.dark-mode #dashboard-content .dashboard-filter {
            background: #1a1a2e;
            border-color: #444;
            color: #e0e0e0;
        }

        body.dark-mode #dashboard-content .dashboard-filter.active {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }

        body.dark-mode #dashboard-content select {
            background: #1a1a2e;
            border-color: #444;
            color: #e0e0e0;
        }

        body.dark-mode #dashboard-content select option {
            background: #1a1a2e;
            color: #e0e0e0;
        }

        body.dark-mode #dashboard-content > div[style*="background: white"] {
            background: #1a1a2e !important;
            border-color: #333 !important;
        }

        body.dark-mode #dashboard-content h3 {
            color: #e0e0e0 !important;
        }

        body.dark-mode #dashboard-content span[style*="color: #666"] {
            color: #999 !important;
        }

        body.dark-mode #platform-bars > div {
            color: #e0e0e0;
        }

        body.dark-mode #platform-bars [style*="background: #ecf0f1"] {
            background: #333 !important;
        }

        body.dark-mode #hot-topics-list > div {
            background: #1a1a2e !important;
            border: 1px solid #333;
        }

        body.dark-mode #hot-topics-list [style*="background: #fff3cd"] {
            background: #2d2d1f !important;
        }

        body.dark-mode #hot-topics-list [style*="background: #f8f9fa"] {
            background: #1a1a2e !important;
        }

        body.dark-mode #data-stream > div {
            background: #1a1a2e !important;
            border-color: #333 !important;
        }

        body.dark-mode #data-stream [style*="color: #666"] {
            color: #999 !important;
        }

        body.dark-mode #heatmap-chart > div {
            opacity: 0.8;
        }

        /* ========== åˆ†ç»„å¼å¯¼èˆªæ ·å¼ ========== */
        .nav-container {
            background: #f6f8fa;
            border-bottom: 1px solid #e1e4e8;
        }

        /* ç¬¬ä¸€è¡Œï¼šåˆ†æè§†å›¾å¯¼èˆª */
        .nav-primary {
            display: flex;
            background: white;
            border-bottom: 2px solid #e1e4e8;
            padding: 0 20px;
            flex-wrap: wrap;
            gap: 5px;
        }

        .nav-tab {
            padding: 15px 25px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 500;
            color: #586069;
            border-bottom: 3px solid transparent;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            background: none;
            border-top: none;
            border-left: none;
            border-right: none;
        }

        .nav-tab:hover {
            color: #0366d6;
            background: rgba(88, 166, 255, 0.08);
        }

        .nav-tab.active {
            color: #0366d6;
            border-bottom-color: #0366d6;
            background: white;
        }

        /* ç¬¬äºŒè¡Œï¼šæ•°æ®æºç­›é€‰å™¨ */
        .nav-secondary {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px 20px;
            background: #f6f8fa;
            flex-wrap: wrap;
        }

        .source-category {
            padding: 8px 15px;
            border: 1px solid #d0d7de;
            border-radius: 8px;
            background: white;
            font-size: 0.9em;
            color: #24292e;
            cursor: pointer;
            min-width: 140px;
        }

        .source-category:hover {
            border-color: #0366d6;
        }

        .source-category:focus {
            outline: none;
            border-color: #0366d6;
            box-shadow: 0 0 0 3px rgba(3, 102, 214, 0.1);
        }

        .source-tags {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            align-items: center;
        }

        .source-tag {
            padding: 6px 14px;
            border: 1px solid #d0d7de;
            border-radius: 20px;
            background: white;
            font-size: 0.85em;
            color: #586069;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
        }

        .source-tag:hover {
            border-color: #0366d6;
            color: #0366d6;
            background: rgba(3, 102, 214, 0.05);
        }

        .source-tag.active {
            background: #0366d6;
            color: white;
            border-color: #0366d6;
        }

        .source-divider {
            width: 1px;
            height: 20px;
            background: #d0d7de;
            margin: 0 5px;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 1024px) {
            .nav-primary {
                padding: 0 15px;
            }
            
            .nav-tab {
                padding: 12px 18px;
                font-size: 0.95em;
            }
            
            .nav-secondary {
                padding: 10px 15px;
            }
        }

        @media (max-width: 768px) {
            .nav-primary {
                flex-wrap: nowrap;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                scrollbar-width: none;
            }
            
            .nav-primary::-webkit-scrollbar {
                display: none;
            }
            
            .nav-tab {
                padding: 12px 16px;
                font-size: 0.9em;
                white-space: nowrap;
            }
            
            .nav-secondary {
                flex-direction: column;
                align-items: stretch;
                gap: 10px;
            }
            
            .source-category {
                width: 100%;
            }
            
            .source-tags {
                overflow-x: auto;
                flex-wrap: nowrap;
                padding-bottom: 5px;
                -webkit-overflow-scrolling: touch;
                scrollbar-width: none;
            }
            
            .source-tags::-webkit-scrollbar {
                display: none;
            }
        }

        /* æ·±è‰²æ¨¡å¼é€‚é… */
        body.dark-mode .nav-container {
            background: #0f0f23;
            border-bottom-color: #333;
        }

        body.dark-mode .nav-primary {
            background: #0f0f23;
            border-bottom-color: #333;
        }

        body.dark-mode .nav-tab {
            color: #b0b0b0;
        }

        body.dark-mode .nav-tab:hover {
            color: #58a6ff;
            background: rgba(88, 166, 255, 0.1);
        }

        body.dark-mode .nav-tab.active {
            color: #58a6ff;
            border-bottom-color: #58a6ff;
            background: #0f0f23;
        }

        body.dark-mode .nav-secondary {
            background: #1a1a2e;
        }

        body.dark-mode .source-category {
            background: #1a1a2e;
            border-color: #444;
            color: #e0e0e0;
        }

        body.dark-mode .source-category:hover,
        body.dark-mode .source-category:focus {
            border-color: #58a6ff;
        }

        body.dark-mode .source-tag {
            background: #1a1a2e;
            border-color: #444;
            color: #b0b0b0;
        }

        body.dark-mode .source-tag:hover {
            border-color: #58a6ff;
            color: #58a6ff;
            background: rgba(88, 166, 255, 0.1);
        }

        body.dark-mode .source-tag.active {
            background: #58a6ff;
            color: white;
            border-color: #58a6ff;
        }

        body.dark-mode .source-divider {
            background: #444;
        }

        /* æ•°æ®æºå†…å®¹åŒºåŸŸ */
        .source-content-section {
            display: none;
        }

        .source-content-section.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”¥ æ¯æ—¥çƒ­é—¨æ•°æ®æŠ¥å‘Š</h1>
            <p>ç”Ÿæˆæ—¶é—´: <span id="generated-time">--</span></p>
            <div class="stats-bar">
                <div class="stat-item">
                    <div class="stat-value" id="total-items">--</div>
                    <div class="stat-label">æ€»æ•°æ®é‡</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="total-sources">--</div>
                    <div class="stat-label">æ•°æ®æº</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="total-topics">--</div>
                    <div class="stat-label">è¯é¢˜æ•°</div>
                </div>
            </div>
        </div>

        <!-- æ•°æ®æºçŠ¶æ€æ  - åªåœ¨æœ‰éœ€è¦åˆ·æ–°çš„æ•°æ®æºæ—¶æ˜¾ç¤º -->
        <div class="source-status-bar" id="source-status-bar" style="display: none;">
            <div class="source-status-title">
                ğŸ“¡ æ•°æ®æºçŠ¶æ€
                <button class="refresh-btn" onclick="refreshAllSources()" id="refresh-all-btn">åˆ·æ–°å…¨éƒ¨</button>
            </div>
            <div class="source-status-grid" id="source-status-grid">
                <!-- åŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>

        <!-- åˆ†ç»„å¼å¯¼èˆª -->
        <div class="nav-container">
            <!-- ç¬¬ä¸€è¡Œï¼šåˆ†æè§†å›¾å¯¼èˆª -->
            <div class="nav-primary">
                <button class="nav-tab active" data-view="overview">ğŸ“Š æ€»è§ˆ</button>
                <button class="nav-tab" data-view="keywords">ğŸ·ï¸ å…³é”®è¯</button>
                <button class="nav-tab" data-view="trends">ğŸ“ˆ è¶‹åŠ¿</button>
                <button class="nav-tab" data-view="github-weekly">ğŸ”¥ GitHubæœ¬å‘¨å¢é•¿</button>
                <button class="nav-tab" data-view="dashboard">ğŸ“Š ä»ªè¡¨ç›˜</button>
            </div>
            
            <!-- ç¬¬äºŒè¡Œï¼šæ•°æ®æºç­›é€‰å™¨ -->
            <div class="nav-secondary">
                <select class="source-category" id="source-category">
                    <option value="all">å…¨éƒ¨æ•°æ®æº</option>
                    <option value="social">ç¤¾äº¤åª’ä½“</option>
                    <option value="tech">æŠ€æœ¯ç¤¾åŒº</option>
                    <option value="video">è§†é¢‘å¹³å°</option>
                    <option value="academic">å­¦æœ¯èµ„æº</option>
                </select>
                
                <div class="source-divider"></div>
                
                <div class="source-tags">
                    <button class="source-tag active" data-source="all">å…¨éƒ¨</button>
                    <button class="source-tag" data-source="github">ğŸ™ GitHub</button>
                    <button class="source-tag" data-source="github_ai">ğŸ¤– AI</button>
                    <button class="source-tag" data-source="hackernews">ğŸ“° HN</button>
                    <button class="source-tag" data-source="bilibili">ğŸ“º Bç«™</button>
                    <button class="source-tag" data-source="arxiv">ğŸ“š ArXiv</button>
                    <button class="source-tag" data-source="zhihu">â“ çŸ¥ä¹</button>
                    <button class="source-tag" data-source="weibo">ğŸ“± å¾®åš</button>
                    <button class="source-tag" data-source="douyin">ğŸµ æŠ–éŸ³</button>
                </div>
            </div>
        </div>

        <!-- æ€»è§ˆ -->
        <div id="overview" class="tab-content active">
            <h2 class="section-title">ğŸ“Š æ•°æ®æ¦‚è§ˆ</h2>
            <div id="overview-content" class="source-grid"></div>
        </div>

        <!-- çƒ­é—¨å…³é”®è¯ -->
        <div id="keywords" class="tab-content">
            <div class="keywords-header">
                <h2 class="section-title">ğŸ·ï¸ çƒ­é—¨å…³é”®è¯</h2>
                <div class="word-cloud-controls">
                    <button class="word-cloud-btn active" onclick="setWordCloudShape('circle', this)">â­• åœ†å½¢</button>
                    <button class="word-cloud-btn" onclick="setWordCloudShape('cardioid', this)">â¤ï¸ å¿ƒå½¢</button>
                    <button class="word-cloud-btn" onclick="setWordCloudShape('diamond', this)">ğŸ’ è±å½¢</button>
                    <button class="word-cloud-btn" onclick="setWordCloudShape('triangle', this)">ğŸ”º ä¸‰è§’å½¢</button>
                    <button class="word-cloud-btn" onclick="setWordCloudShape('square', this)">â¬œ æ–¹å½¢</button>
                </div>
            </div>
            <div class="keywords-cloud">
                <canvas id="word-cloud-canvas"></canvas>
                <div class="word-cloud-tooltip" id="word-cloud-tooltip"></div>
            </div>
        </div>

        <!-- æ•°æ®æºè¯¦æƒ… -->
        <div id="source-detail" class="tab-content">
            <h2 class="section-title" id="source-detail-title">ğŸ“¡ æ•°æ®æºè¯¦æƒ…</h2>
            <div id="source-detail-content"></div>
        </div>

        <!-- è¶‹åŠ¿å›¾è¡¨ -->
        <div id="trends" class="tab-content">
            <h2 class="section-title">ğŸ“ˆ è¶‹åŠ¿åˆ†æ</h2>

            <!-- è¶‹åŠ¿æ¦‚è§ˆå¡ç‰‡ -->
            <div class="trend-summary-cards">
                <div class="trend-card">
                    <div class="trend-card-icon">ğŸ“Š</div>
                    <div class="trend-card-info">
                        <div class="trend-card-value" id="trend-total-items">--</div>
                        <div class="trend-card-label">æ€»æ•°æ®é‡</div>
                    </div>
                </div>
                <div class="trend-card">
                    <div class="trend-card-icon">ğŸ“ˆ</div>
                    <div class="trend-card-info">
                        <div class="trend-card-value" id="trend-growth-rate">--</div>
                        <div class="trend-card-label">å¢é•¿ç‡</div>
                    </div>
                </div>
                <div class="trend-card">
                    <div class="trend-card-icon">ğŸ”¥</div>
                    <div class="trend-card-info">
                        <div class="trend-card-value" id="trend-peak-day">--</div>
                        <div class="trend-card-label">å³°å€¼æ—¥æœŸ</div>
                    </div>
                </div>
                <div class="trend-card">
                    <div class="trend-card-icon">ğŸ“…</div>
                    <div class="trend-card-info">
                        <div class="trend-card-value" id="trend-avg-daily">--</div>
                        <div class="trend-card-label">æ—¥å‡æ•°æ®</div>
                    </div>
                </div>
            </div>

            <!-- æ€»æ•°æ®é‡è¶‹åŠ¿å›¾ -->
            <div class="chart-section">
                <h3>ğŸ“ˆ æ€»æ•°æ®é‡è¶‹åŠ¿ï¼ˆå«é¢„æµ‹ï¼‰</h3>
                <div class="chart-container">
                    <canvas id="total-trend-canvas"></canvas>
                </div>
            </div>

            <!-- æ•°æ®æºå¯¹æ¯”è¶‹åŠ¿å›¾ -->
            <div class="chart-section">
                <h3>ğŸ“Š å„æ•°æ®æºè¶‹åŠ¿å¯¹æ¯”</h3>
                <div class="chart-container">
                    <canvas id="source-trend-canvas"></canvas>
                </div>
            </div>

            <!-- çƒ­é—¨å…³é”®è¯è¶‹åŠ¿å›¾ -->
            <div class="chart-section">
                <h3>ğŸ”¥ çƒ­é—¨å…³é”®è¯è¶‹åŠ¿</h3>
                <div class="chart-container">
                    <canvas id="keyword-trend-canvas"></canvas>
                </div>
            </div>

            <!-- è¶‹åŠ¿åˆ†æè¯´æ˜ -->
            <div class="trend-analysis-note">
                <h4>ğŸ“‹ è¶‹åŠ¿åˆ†æè¯´æ˜</h4>
                <ul>
                    <li><strong>ç§»åŠ¨å¹³å‡çº¿ï¼š</strong>ä½¿ç”¨7æ—¥ç§»åŠ¨å¹³å‡å¹³æ»‘æ•°æ®æ³¢åŠ¨ï¼Œæ˜¾ç¤ºé•¿æœŸè¶‹åŠ¿</li>
                    <li><strong>è¶‹åŠ¿é¢„æµ‹ï¼š</strong>åŸºäºå†å²æ•°æ®ä½¿ç”¨çº¿æ€§å›å½’é¢„æµ‹æœªæ¥3å¤©è¶‹åŠ¿</li>
                    <li><strong>å¢é•¿ç‡è®¡ç®—ï¼š</strong>å¯¹æ¯”æœ€è¿‘7å¤©ä¸å‰7å¤©çš„æ•°æ®å˜åŒ–ç™¾åˆ†æ¯”</li>
                </ul>
            </div>
        </div>



        <!-- ä»ªè¡¨ç›˜ -->
        <!-- GitHubæœ¬å‘¨å¢é•¿ -->
        <div id="github-weekly" class="tab-content">
            <h2 class="section-title">ğŸ”¥ GitHubæœ¬å‘¨å¢é•¿é¡¹ç›® TOP 20</h2>
            <div class="github-weekly-intro">
                <p>ğŸ“ˆ åŸºäº GitHub Trending æ•°æ®ï¼Œå±•ç¤ºæœ¬å‘¨å¢é•¿æœ€å¿«çš„å¼€æºé¡¹ç›®</p>
            </div>
            <div id="github-weekly-content">
                <!-- GitHubæœ¬å‘¨å¢é•¿é¡¹ç›®åˆ—è¡¨ -->
            </div>
        </div>

        <div id="dashboard" class="tab-content">
            <h2 class="section-title">ğŸ“Š æ•°æ®ä»ªè¡¨ç›˜</h2>
            <div id="dashboard-content">
                <!-- å¿«é€Ÿç­›é€‰æ  -->
                <div style="background: white; padding: 15px 20px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                    <div style="display: flex; flex-wrap: wrap; align-items: center; gap: 10px;">
                        <span style="font-weight: 500; color: #666; font-size: 0.9em;">å¹³å°:</span>
                        <button class="dashboard-filter active" data-filter="all" style="padding: 6px 14px; border-radius: 20px; border: 1px solid #ddd; background: #3b82f6; color: white; cursor: pointer; font-size: 0.85em;">å…¨éƒ¨</button>
                        <button class="dashboard-filter" data-filter="weibo" style="padding: 6px 14px; border-radius: 20px; border: 1px solid #ddd; background: white; cursor: pointer; font-size: 0.85em;">ğŸ“± å¾®åš</button>
                        <button class="dashboard-filter" data-filter="douyin" style="padding: 6px 14px; border-radius: 20px; border: 1px solid #ddd; background: white; cursor: pointer; font-size: 0.85em;">ğŸµ æŠ–éŸ³</button>
                        <button class="dashboard-filter" data-filter="zhihu" style="padding: 6px 14px; border-radius: 20px; border: 1px solid #ddd; background: white; cursor: pointer; font-size: 0.85em;">â“ çŸ¥ä¹</button>
                        <button class="dashboard-filter" data-filter="bilibili" style="padding: 6px 14px; border-radius: 20px; border: 1px solid #ddd; background: white; cursor: pointer; font-size: 0.85em;">ğŸ“º Bç«™</button>
                        <button class="dashboard-filter" data-filter="github" style="padding: 6px 14px; border-radius: 20px; border: 1px solid #ddd; background: white; cursor: pointer; font-size: 0.85em;">ğŸ™ GitHub</button>
                        <span style="margin-left: auto; display: flex; align-items: center; gap: 8px;">
                            <span style="font-weight: 500; color: #666; font-size: 0.9em;">æ’åº:</span>
                            <select id="dashboard-sort" style="padding: 6px 12px; border-radius: 8px; border: 1px solid #ddd; font-size: 0.85em;">
                                <option value="hot">æŒ‰çƒ­åº¦</option>
                                <option value="time">æŒ‰æ—¶é—´</option>
                            </select>
                        </span>
                    </div>
                </div>

                <!-- å…³é”®æŒ‡æ ‡å¡ç‰‡ - ä¸å¸ƒå±€ä¸‰ä¸€è‡´ -->
                <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 15px; margin-bottom: 20px;">
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 12px; text-align: center; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                            <span style="font-size: 1.8em;">ğŸ“Š</span>
                            <span style="font-size: 0.7em; background: rgba(255,255,255,0.2); padding: 2px 8px; border-radius: 10px;">+12%</span>
                        </div>
                        <p style="font-size: 1.8em; font-weight: bold; margin: 0;" id="metric-total">0</p>
                        <p style="font-size: 0.85em; opacity: 0.9; margin: 5px 0 0 0;">æ€»æ•°æ®é‡</p>
                    </div>
                    <div style="background: white; padding: 20px; border-radius: 12px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.08); border: 1px solid #e5e7eb;">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                            <span style="font-size: 1.8em;">ğŸ”¥</span>
                            <span style="font-size: 0.7em; background: #dbeafe; color: #1d4ed8; padding: 2px 8px; border-radius: 10px;">å®æ—¶</span>
                        </div>
                        <p style="font-size: 1.8em; font-weight: bold; margin: 0; color: #1f2937;" id="metric-hot">0</p>
                        <p style="font-size: 0.85em; color: #6b7280; margin: 5px 0 0 0;">çƒ­é—¨è¯é¢˜</p>
                    </div>
                    <div style="background: white; padding: 20px; border-radius: 12px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.08); border: 1px solid #e5e7eb;">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                            <span style="font-size: 1.8em;">ğŸ“ˆ</span>
                            <span style="font-size: 0.7em; background: #d1fae5; color: #059669; padding: 2px 8px; border-radius: 10px;">æ´»è·ƒ</span>
                        </div>
                        <p style="font-size: 1.8em; font-weight: bold; margin: 0; color: #1f2937;" id="metric-platforms">0</p>
                        <p style="font-size: 0.85em; color: #6b7280; margin: 5px 0 0 0;">æ´»è·ƒå¹³å°</p>
                    </div>
                    <div style="background: white; padding: 20px; border-radius: 12px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.08); border: 1px solid #e5e7eb;">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                            <span style="font-size: 1.8em;">âš¡</span>
                            <span style="font-size: 0.7em; background: #ffedd5; color: #ea580c; padding: 2px 8px; border-radius: 10px;">å³°å€¼</span>
                        </div>
                        <p style="font-size: 1.8em; font-weight: bold; margin: 0; color: #1f2937;" id="metric-peak">0</p>
                        <p style="font-size: 0.85em; color: #6b7280; margin: 5px 0 0 0;">æœ€é«˜çƒ­åº¦</p>
                    </div>
                    <div style="background: white; padding: 20px; border-radius: 12px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.08); border: 1px solid #e5e7eb;">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                            <span style="font-size: 1.8em;">ğŸ•</span>
                            <span style="font-size: 0.7em; background: #f3e8ff; color: #7c3aed; padding: 2px 8px; border-radius: 10px;">æ›´æ–°</span>
                        </div>
                        <p style="font-size: 1.2em; font-weight: bold; margin: 0; color: #1f2937;" id="metric-update">--:--</p>
                        <p style="font-size: 0.85em; color: #6b7280; margin: 5px 0 0 0;">æœ€åæ›´æ–°</p>
                    </div>
                </div>

                <!-- æ•°æ®å¯è§†åŒ–åŒºåŸŸ -->
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <!-- å¹³å°åˆ†å¸ƒ -->
                    <div style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); border: 1px solid #e5e7eb;">
                        <h3 style="margin-bottom: 15px; color: #1f2937; font-size: 1em; font-weight: 600;">ğŸ“Š å¹³å°åˆ†å¸ƒ</h3>
                        <div id="platform-bars"></div>
                    </div>
                    
                    <!-- çƒ­åº¦è¶‹åŠ¿ -->
                    <div style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); border: 1px solid #e5e7eb;">
                        <h3 style="margin-bottom: 15px; color: #1f2937; font-size: 1em; font-weight: 600;">ğŸ“ˆ çƒ­åº¦è¶‹åŠ¿</h3>
                        <div id="trend-chart" style="height: 160px; display: flex; align-items: flex-end; justify-content: space-around; gap: 8px;"></div>
                    </div>
                    
                    <!-- æ´»è·ƒæ—¶æ®µ -->
                    <div style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); border: 1px solid #e5e7eb;">
                        <h3 style="margin-bottom: 15px; color: #1f2937; font-size: 1em; font-weight: 600;">ğŸ”¥ æ´»è·ƒæ—¶æ®µ</h3>
                        <div id="heatmap-chart" style="display: grid; grid-template-columns: repeat(24, 1fr); gap: 2px;"></div>
                        <div style="display: flex; justify-content: space-between; margin-top: 8px; font-size: 0.7em; color: #9ca3af;">
                            <span>00:00</span><span>06:00</span><span>12:00</span><span>18:00</span><span>23:00</span>
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <div class="footer">
            <p>Â© 2025 Trending Service | æ•°æ®æ¯å¤©8ï¼š00æ›´æ–°</p>
        </div>
    </div>

    <button class="dark-mode-toggle" onclick="toggleDarkMode()">ğŸŒ™</button>

    <script>
        // æŠ¥å‘Šæ•°æ®
        window.REPORT_DATA = {};

        // å½“å‰çŠ¶æ€
        let currentView = 'overview';
        let currentSource = 'all';

        // API é…ç½®
        const API_BASE_URL = 'http://localhost:8888';

        // æ•°æ®æºé…ç½®
        const sourceConfig = {
            'github': { icon: 'ğŸ™', name: 'GitHub', category: 'tech' },
            'github_ai': { icon: 'ğŸ¤–', name: 'GitHub AI', category: 'tech' },
            'hackernews': { icon: 'ğŸ“°', name: 'HackerNews', category: 'tech' },
            'bilibili': { icon: 'ğŸ“º', name: 'Bilibili', category: 'video' },
            'arxiv': { icon: 'ğŸ“š', name: 'ArXiv', category: 'academic' },
            'zhihu': { icon: 'â“', name: 'çŸ¥ä¹', category: 'social' },
            'weibo': { icon: 'ğŸ“±', name: 'å¾®åš', category: 'social' },
            'douyin': { icon: 'ğŸµ', name: 'æŠ–éŸ³', category: 'social' }
        };

        // åˆ‡æ¢åˆ†æè§†å›¾
        function switchView(viewName) {
            currentView = viewName;
            
            // æ›´æ–°å¯¼èˆªTabæ ·å¼
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.dataset.view === viewName) {
                    tab.classList.add('active');
                }
            });
            
            // æ›´æ–°å†…å®¹åŒºåŸŸæ˜¾ç¤º
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // å¦‚æœæ˜¯æ•°æ®æºè¯¦æƒ…è§†å›¾
            if (viewName === 'source-detail') {
                document.getElementById('source-detail').classList.add('active');
                renderSourceDetail();
            } else {
                document.getElementById(viewName).classList.add('active');
            }
            
            // æ ¹æ®è§†å›¾æ›´æ–°æ•°æ®æºç­›é€‰å™¨å¯è§æ€§
            updateSourceFilterVisibility();
        }

        // åˆ‡æ¢æ•°æ®æº
        function switchSource(sourceName) {
            currentSource = sourceName;
            
            // æ›´æ–°æ ‡ç­¾æ ·å¼
            document.querySelectorAll('.source-tag').forEach(tag => {
                tag.classList.remove('active');
                if (tag.dataset.source === sourceName) {
                    tag.classList.add('active');
                }
            });
            
            // æ›´æ–°åˆ†ç±»ä¸‹æ‹‰æ¡†
            const categorySelect = document.getElementById('source-category');
            if (sourceName === 'all') {
                categorySelect.value = 'all';
            } else {
                const config = sourceConfig[sourceName];
                if (config) {
                    categorySelect.value = config.category;
                }
            }
            
            // å¦‚æœå½“å‰åœ¨æ•°æ®æºè¯¦æƒ…è§†å›¾ï¼Œåˆ·æ–°å†…å®¹
            if (currentView === 'source-detail') {
                renderSourceDetail();
            } else if (currentView === 'overview') {
                // åœ¨æ€»è§ˆè§†å›¾ä¸‹ï¼Œç­›é€‰æ˜¾ç¤ºçš„æ•°æ®æº
                renderOverview(window.REPORT_DATA);
            } else if (currentView === 'keywords') {
                renderKeywords(window.REPORT_DATA);
            } else if (currentView === 'dashboard') {
                renderDashboard(window.REPORT_DATA);
            }
        }

        // æ ¹æ®åˆ†ç±»ç­›é€‰æ•°æ®æº
        function filterByCategory(category) {
            // æ›´æ–°æ ‡ç­¾é«˜äº®çŠ¶æ€
            document.querySelectorAll('.source-tag').forEach(tag => {
                const sourceName = tag.dataset.source;
                if (sourceName === 'all') {
                    tag.style.display = category === 'all' ? 'inline-block' : 'none';
                } else {
                    const config = sourceConfig[sourceName];
                    if (category === 'all' || (config && config.category === category)) {
                        tag.style.display = 'inline-block';
                    } else {
                        tag.style.display = 'none';
                    }
                }
            });
            
            // å¦‚æœå½“å‰é€‰ä¸­çš„æ•°æ®æºè¢«éšè—ï¼Œåˆ‡æ¢åˆ°"å…¨éƒ¨"
            if (category !== 'all' && currentSource !== 'all') {
                const currentConfig = sourceConfig[currentSource];
                if (!currentConfig || currentConfig.category !== category) {
                    switchSource('all');
                }
            }
        }

        // æ›´æ–°æ•°æ®æºç­›é€‰å™¨å¯è§æ€§
        function updateSourceFilterVisibility() {
            const navSecondary = document.querySelector('.nav-secondary');
            // è¶‹åŠ¿å›¾è¡¨è§†å›¾ä¸éœ€è¦æ•°æ®æºç­›é€‰
            if (currentView === 'trends') {
                navSecondary.style.display = 'none';
            } else {
                navSecondary.style.display = 'flex';
            }
        }

        // æ¸²æŸ“æ•°æ®æºè¯¦æƒ…
        function renderSourceDetail() {
            const container = document.getElementById('source-detail-content');
            const titleEl = document.getElementById('source-detail-title');
            const sources = window.REPORT_DATA.sources || {};
            
            if (currentSource === 'all') {
                // æ˜¾ç¤ºæ‰€æœ‰æ•°æ®æºçš„è¯¦ç»†åˆ—è¡¨
                titleEl.textContent = 'ğŸ“¡ å…¨éƒ¨æ•°æ®æºè¯¦æƒ…';
                let html = '';
                for (const [sourceName, items] of Object.entries(sources)) {
                    const config = sourceConfig[sourceName] || { icon: 'ğŸ“„', name: sourceName };
                    html += renderSourceSection(config.icon, config.name, items, sourceName);
                }
                container.innerHTML = html || '<div class="empty-state"><div class="emoji">ğŸ“­</div><div>æš‚æ— æ•°æ®</div></div>';
            } else {
                // æ˜¾ç¤ºå•ä¸ªæ•°æ®æº
                const config = sourceConfig[currentSource] || { icon: 'ğŸ“„', name: currentSource };
                const items = sources[currentSource] || [];
                titleEl.textContent = `${config.icon} ${config.name}`;
                container.innerHTML = renderSourceCards(items, currentSource);
            }
        }

        // æ¸²æŸ“æ•°æ®æºåŒºå—
        function renderSourceSection(icon, name, items, sourceName) {
            if (!items || items.length === 0) return '';
            return `
                <div class="source-section" style="margin-bottom: 30px;">
                    <h3 style="font-size: 1.3em; color: #24292e; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 2px solid #e1e4e8;">
                        ${icon} ${name}
                    </h3>
                    ${renderSourceCards(items, sourceName)}
                </div>
            `;
        }

        // æ¸²æŸ“æ•°æ®æºå¡ç‰‡ç½‘æ ¼
        function renderSourceCards(items, sourceName) {
            if (!items || items.length === 0) {
                return '<div class="empty-state"><div class="emoji">ğŸ“­</div><div>æš‚æ— æ•°æ®</div></div>';
            }
            return `
                <div class="items-card-grid">
                    ${items.map((item, index) => `
                        <div class="item-card">
                            <div class="item-card-header">
                                <div class="item-card-rank">${index + 1}</div>
                                <div class="item-card-score">${item.hot_score ? 'ğŸ”¥ ' + formatNumber(item.hot_score) : ''}</div>
                            </div>
                            <div class="item-card-body">
                                <a href="${item.url}" target="_blank" class="item-card-title">${item.title}</a>
                                <div class="item-card-meta">
                                    ${item.author ? `<span class="meta-tag">ğŸ‘¤ ${item.author}</span>` : ''}
                                    ${item.category ? `<span class="meta-tag">ğŸ·ï¸ ${item.category}</span>` : ''}
                                </div>
                                ${renderDescription(item.description, sourceName, index)}
                                ${item.keywords && item.keywords.length > 0 ? `<div class="item-card-keywords">${item.keywords.map(k => `<span class="item-keyword">${k}</span>`).join('')}</div>` : ''}
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // åˆ‡æ¢æš—è‰²æ¨¡å¼
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            const btn = document.querySelector('.dark-mode-toggle');
            btn.textContent = document.body.classList.contains('dark-mode') ? 'â˜€ï¸' : 'ğŸŒ™';
        }

        // æ¸²æŸ“æ€»è§ˆ
        function renderOverview(data) {
            const container = document.getElementById('overview-content');
            let sources = data.sources || {};
            
            // åº”ç”¨æ•°æ®æºç­›é€‰
            if (currentSource !== 'all') {
                const filtered = {};
                if (sources[currentSource]) {
                    filtered[currentSource] = sources[currentSource];
                }
                sources = filtered;
            }
            
            if (Object.keys(sources).length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="emoji">ğŸ“­</div><div>æš‚æ— æ•°æ®</div></div>';
                return;
            }

            // è®¡ç®—æ¯ä¸ªæ•°æ®æºå‰10é¡¹çš„çƒ­åº¦æ€»å’Œå¹¶æ’åº
            const sourceWithHeat = Object.entries(sources).map(([source, items]) => {
                const top10Items = items.slice(0, 10);
                const totalHeat = top10Items.reduce((sum, item) => sum + (item.hot_score || 0), 0);
                return { source, items, totalHeat };
            }).sort((a, b) => b.totalHeat - a.totalHeat);

            let html = '';
            for (const { source, items } of sourceWithHeat) {
                const config = sourceConfig[source] || { icon: 'ğŸ“„', name: source };
                
                html += `
                    <div class="source-card">
                        <div class="source-header">
                            <div class="source-name">${config.icon} ${config.name}</div>
                            <div class="source-count">${items.length} æ¡</div>
                        </div>
                        <div class="source-content">
                            <ul class="item-list overview-list">
                                ${items.slice(0, 10).map((item, index) => `
                                    <li class="overview-item">
                                        <div class="item-rank">${index + 1}</div>
                                        <div class="item-title">
                                            <a href="${item.url}" target="_blank">${item.title}</a>
                                            <div class="item-meta">
                                                ${item.author ? `<span class="meta-tag">ğŸ‘¤ ${item.author}</span>` : ''}
                                            </div>
                                        </div>
                                        <div class="item-score">${item.hot_score ? 'ğŸ”¥ ' + formatNumber(item.hot_score) : ''}</div>
                                    </li>
                                `).join('')}
                            </ul>
                        </div>
                    </div>
                `;
            }
            container.innerHTML = html;
        }

        // è¯äº‘å½¢çŠ¶é…ç½®
        let currentWordCloudShape = 'circle';
        let wordCloudInstance = null;

        // è®¾ç½®è¯äº‘å½¢çŠ¶
        function setWordCloudShape(shape, clickedBtn) {
            currentWordCloudShape = shape;
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.word-cloud-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            if (clickedBtn) {
                clickedBtn.classList.add('active');
            }
            // é‡æ–°æ¸²æŸ“
            if (window.REPORT_DATA && window.REPORT_DATA.keywords) {
                renderWordCloud(window.REPORT_DATA.keywords);
            }
        }

        // æ¸²æŸ“è¯äº‘
        function renderWordCloud(keywords) {
            const canvas = document.getElementById('word-cloud-canvas');
            if (!canvas || !keywords || Object.keys(keywords).length === 0) return;

            // å‡†å¤‡æ•°æ®
            const wordList = Object.entries(keywords).map(([word, count]) => {
                return [word, count];
            });

            // é¢œè‰²æ–¹æ¡ˆ
            const colors = [
                '#667eea', '#764ba2', '#f093fb', '#f5576c',
                '#4facfe', '#00f2fe', '#43e97b', '#38f9d7',
                '#ffecd2', '#fcb69f', '#ff8a80', '#ffab91',
                '#b9f6ca', '#a5d6a7', '#80cbc4', '#4db6ac'
            ];

            // å½¢çŠ¶æ˜ å°„
            const shapeMap = {
                'circle': 'circle',
                'cardioid': 'cardioid',
                'diamond': 'diamond',
                'triangle': 'triangle',
                'square': 'square'
            };

            // è·å– tooltip å…ƒç´ 
            const tooltip = document.getElementById('word-cloud-tooltip');

            // é…ç½®é€‰é¡¹
            const options = {
                list: wordList,
                gridSize: 8,
                weightFactor: function(size) {
                    // æ ¹æ® canvas å¤§å°è°ƒæ•´å­—ä½“
                    const canvasWidth = canvas.width || canvas.offsetWidth;
                    return Math.pow(size, 0.8) * (canvasWidth / 800) * 0.8;
                },
                fontFamily: '"PingFang SC", "Microsoft YaHei", sans-serif',
                color: function() {
                    return colors[Math.floor(Math.random() * colors.length)];
                },
                rotateRatio: 0.3,
                rotationSteps: 2,
                backgroundColor: 'transparent',
                shape: shapeMap[currentWordCloudShape] || 'circle',
                ellipticity: 1,
                drawOutOfBound: false,
                shrinkToFit: true,

                // æ‚¬åœæ•ˆæœ
                hover: function(item, dimension, event) {
                    if (item) {
                        tooltip.style.display = 'block';
                        tooltip.style.left = event.offsetX + 10 + 'px';
                        tooltip.style.top = event.offsetY + 10 + 'px';
                        tooltip.innerHTML = `<strong>${item[0]}</strong><br>å‡ºç°æ¬¡æ•°: ${item[1]}`;
                        canvas.style.cursor = 'pointer';
                    } else {
                        tooltip.style.display = 'none';
                        canvas.style.cursor = 'default';
                    }
                },

                // ç‚¹å‡»æ•ˆæœ
                click: function(item) {
                    if (item) {
                        // å¯ä»¥æ·»åŠ ç‚¹å‡»ç­›é€‰åŠŸèƒ½
                        console.log('ç‚¹å‡»äº†å…³é”®è¯:', item[0]);
                    }
                }
            };

            // è®¾ç½® canvas å°ºå¯¸
            const container = canvas.parentElement;
            canvas.width = container.offsetWidth;
            canvas.height = 400;

            // æ¸²æŸ“è¯äº‘
            if (typeof WordCloud !== 'undefined') {
                WordCloud(canvas, options);
            } else {
                // å¦‚æœ WordCloud2.js æœªåŠ è½½ï¼Œæ˜¾ç¤ºå¤‡ç”¨å†…å®¹
                console.warn('WordCloud2.js æœªåŠ è½½ï¼Œæ˜¾ç¤ºå¤‡ç”¨å…³é”®è¯åˆ—è¡¨');
                renderKeywordsBackup(keywords);
            }
        }

        // å¤‡ç”¨å…³é”®è¯æ¸²æŸ“ï¼ˆå½“ WordCloud2.js æœªåŠ è½½æ—¶ï¼‰
        function renderKeywordsBackup(keywords) {
            const canvas = document.getElementById('word-cloud-canvas');
            if (!canvas) return;

            const container = canvas.parentElement;
            const sortedKeywords = Object.entries(keywords).sort((a, b) => b[1] - a[1]);

            let html = '<div style="display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; padding: 20px;">';
            sortedKeywords.forEach(([keyword, count]) => {
                html += `<span style="
                    display: inline-block;
                    padding: 6px 14px;
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    color: white;
                    border-radius: 20px;
                    font-size: ${Math.max(0.8, Math.min(1.5, count / 10))}em;
                    cursor: pointer;
                    transition: all 0.2s ease;
                ">${keyword} <span style="opacity: 0.8; font-size: 0.7em;">${count}</span></span>`;
            });
            html += '</div>';

            container.innerHTML = html;
        }

        // æ¸²æŸ“å…³é”®è¯ - ä¸»å…¥å£
        function renderKeywords(data) {
            const keywords = data.keywords || {};

            if (Object.keys(keywords).length === 0) {
                const canvas = document.getElementById('word-cloud-canvas');
                if (canvas) {
                    const container = canvas.parentElement;
                    container.innerHTML = '<div class="empty-state"><div class="emoji">ğŸ·ï¸</div><div>æš‚æ— å…³é”®è¯æ•°æ®</div></div>';
                }
                return;
            }

            // ä½¿ç”¨ WordCloud2.js æ¸²æŸ“
            renderWordCloud(keywords);
        }

        // æ¸²æŸ“æè¿°ï¼ˆæ”¯æŒå±•å¼€/æ”¶èµ·ï¼‰
        function renderDescription(description, sourceName, index) {
            if (!description || description === '-') {
                return '';
            }

            // åªæœ‰çŸ¥ä¹æ•°æ®æºä¸”æè¿°è¾ƒé•¿æ—¶æ‰ä½¿ç”¨å±•å¼€åŠŸèƒ½
            const isZhihu = sourceName === 'zhihu';
            const maxLength = 100;

            if (!isZhihu || description.length <= maxLength) {
                return `<div class="item-card-description">${description}</div>`;
            }

            const shortDesc = description.substring(0, maxLength) + '...';
            const descId = `desc-${sourceName}-${index}`;

            return `
                <div class="item-card-description expandable" id="${descId}">
                    <span class="desc-short">${shortDesc}</span>
                    <span class="desc-full" style="display: none;">${description}</span>
                    <button class="desc-toggle" onclick="toggleDescription('${descId}')">å±•å¼€</button>
                </div>
            `;
        }

        // åˆ‡æ¢æè¿°å±•å¼€/æ”¶èµ·
        function toggleDescription(descId) {
            const descEl = document.getElementById(descId);
            const shortEl = descEl.querySelector('.desc-short');
            const fullEl = descEl.querySelector('.desc-full');
            const btnEl = descEl.querySelector('.desc-toggle');

            if (fullEl.style.display === 'none') {
                shortEl.style.display = 'none';
                fullEl.style.display = 'inline';
                btnEl.textContent = 'æ”¶èµ·';
            } else {
                shortEl.style.display = 'inline';
                fullEl.style.display = 'none';
                btnEl.textContent = 'å±•å¼€';
            }
        }

        // æ ¼å¼åŒ–æ•°å­—ï¼ˆæ·»åŠ åƒåˆ†ä½ï¼‰
        function formatNumber(num) {
            if (num >= 1000000) {
                return (num / 1000000).toFixed(1) + 'M';
            } else if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'K';
            }
            return Math.round(num).toString();
        }

        // æ¸²æŸ“è¶‹åŠ¿å›¾è¡¨ - ä½¿ç”¨ Chart.js å’Œæ—¶é—´åºåˆ—åˆ†æ
        function renderTrends(data) {
            const trends = data.trends || {};

            // æ›´æ–°è¶‹åŠ¿æ¦‚è§ˆå¡ç‰‡
            updateTrendSummary(trends.summary);

            // æ¸²æŸ“æ€»è¶‹åŠ¿å›¾ï¼ˆå«é¢„æµ‹ï¼‰
            renderTotalTrendChart(trends.summary);

            // æ¸²æŸ“æ•°æ®æºè¶‹åŠ¿å¯¹æ¯”å›¾
            renderSourceTrendChart(trends.source_trends);

            // æ¸²æŸ“å…³é”®è¯è¶‹åŠ¿å›¾
            renderKeywordTrendChart(trends.keyword_trends);
        }

        // æ›´æ–°è¶‹åŠ¿æ¦‚è§ˆå¡ç‰‡
        function updateTrendSummary(summary) {
            if (!summary || !summary.total_trend || summary.total_trend.length === 0) {
                return;
            }

            const trend = summary.total_trend;
            const total = trend.reduce((sum, day) => sum + day.count, 0);
            const avgDaily = Math.round(total / trend.length);

            // è®¡ç®—å¢é•¿ç‡ï¼ˆæœ€è¿‘7å¤© vs å‰7å¤©ï¼‰
            const recent7 = trend.slice(-7);
            const previous7 = trend.slice(-14, -7);
            const recentSum = recent7.reduce((sum, day) => sum + day.count, 0);
            const previousSum = previous7.reduce((sum, day) => sum + day.count, 0);
            const growthRate = previousSum > 0 ? ((recentSum - previousSum) / previousSum * 100).toFixed(1) : 0;

            // æ‰¾å‡ºå³°å€¼æ—¥æœŸ
            const peakDay = trend.reduce((max, day) => day.count > max.count ? day : max, trend[0]);

            // æ›´æ–°å¡ç‰‡
            document.getElementById('trend-total-items').textContent = formatNumber(total);
            document.getElementById('trend-growth-rate').textContent = (growthRate > 0 ? '+' : '') + growthRate + '%';
            document.getElementById('trend-growth-rate').style.color = growthRate >= 0 ? '#43e97b' : '#ff6b6b';
            document.getElementById('trend-peak-day').textContent = new Date(peakDay.date).toLocaleDateString('zh-CN', {month: 'short', day: 'numeric'});
            document.getElementById('trend-avg-daily').textContent = formatNumber(avgDaily);
        }

        // è®¡ç®—ç§»åŠ¨å¹³å‡çº¿
        function calculateMovingAverage(data, period = 7) {
            const result = [];
            for (let i = 0; i < data.length; i++) {
                if (i < period - 1) {
                    result.push(null);
                } else {
                    let sum = 0;
                    for (let j = 0; j < period; j++) {
                        sum += data[i - j].count;
                    }
                    result.push(Math.round(sum / period));
                }
            }
            return result;
        }

        // çº¿æ€§å›å½’é¢„æµ‹
        function linearRegressionPredict(data, daysToPredict = 3) {
            const n = data.length;
            if (n < 2) return [];

            // è®¡ç®—å‡å€¼
            let sumX = 0, sumY = 0, sumXY = 0, sumXX = 0;
            for (let i = 0; i < n; i++) {
                sumX += i;
                sumY += data[i].count;
                sumXY += i * data[i].count;
                sumXX += i * i;
            }

            const meanX = sumX / n;
            const meanY = sumY / n;

            // è®¡ç®—æ–œç‡å’Œæˆªè·
            const slope = (sumXY - n * meanX * meanY) / (sumXX - n * meanX * meanX);
            const intercept = meanY - slope * meanX;

            // ç”Ÿæˆé¢„æµ‹
            const predictions = [];
            const lastDate = new Date(data[n - 1].date);

            for (let i = 1; i <= daysToPredict; i++) {
                const predictedValue = Math.round(slope * (n - 1 + i) + intercept);
                const predictedDate = new Date(lastDate);
                predictedDate.setDate(predictedDate.getDate() + i);

                predictions.push({
                    date: predictedDate.toISOString().split('T')[0],
                    count: Math.max(0, predictedValue),
                    isPrediction: true
                });
            }

            return predictions;
        }

        // æ¸²æŸ“æ€»è¶‹åŠ¿å›¾ï¼ˆå«é¢„æµ‹ï¼‰
        function renderTotalTrendChart(summary) {
            const canvas = document.getElementById('total-trend-canvas');
            if (!canvas || !summary || !summary.total_trend || summary.total_trend.length === 0) {
                return;
            }

            const trend = summary.total_trend;
            const labels = trend.map(d => new Date(d.date).toLocaleDateString('zh-CN', {month: 'short', day: 'numeric'}));
            const data = trend.map(d => d.count);

            // è®¡ç®—ç§»åŠ¨å¹³å‡çº¿
            const movingAvg = calculateMovingAverage(trend, 7);

            // ç”Ÿæˆé¢„æµ‹
            const predictions = linearRegressionPredict(trend, 3);
            const predictionLabels = predictions.map(p => new Date(p.date).toLocaleDateString('zh-CN', {month: 'short', day: 'numeric'}));
            const predictionData = predictions.map(p => p.count);

            // é”€æ¯æ—§å›¾è¡¨
            if (window.totalTrendChart) {
                window.totalTrendChart.destroy();
            }

            // åˆ›å»ºæ–°å›¾è¡¨
            window.totalTrendChart = new Chart(canvas, {
                type: 'line',
                data: {
                    labels: [...labels, ...predictionLabels],
                    datasets: [
                        {
                            label: 'å®é™…æ•°æ®',
                            data: [...data, ...Array(predictions.length).fill(null)],
                            borderColor: '#667eea',
                            backgroundColor: 'rgba(102, 126, 234, 0.1)',
                            fill: true,
                            tension: 0.4,
                            pointRadius: 4,
                            pointBackgroundColor: '#667eea'
                        },
                        {
                            label: '7æ—¥ç§»åŠ¨å¹³å‡',
                            data: [...movingAvg, ...Array(predictions.length).fill(null)],
                            borderColor: '#f093fb',
                            borderDash: [5, 5],
                            fill: false,
                            tension: 0.4,
                            pointRadius: 0
                        },
                        {
                            label: 'è¶‹åŠ¿é¢„æµ‹',
                            data: [...Array(data.length - 1).fill(null), data[data.length - 1], ...predictionData],
                            borderColor: '#ff6b6b',
                            borderDash: [10, 5],
                            fill: false,
                            tension: 0.4,
                            pointRadius: 4,
                            pointBackgroundColor: '#ff6b6b'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                usePointStyle: true,
                                padding: 15
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.y !== null) {
                                        label += context.parsed.y + ' æ¡';
                                    }
                                    return label;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

        // æ¸²æŸ“æ•°æ®æºè¶‹åŠ¿å¯¹æ¯”å›¾
        function renderSourceTrendChart(sourceTrends) {
            const canvas = document.getElementById('source-trend-canvas');
            if (!canvas || !sourceTrends || Object.keys(sourceTrends).length === 0) {
                return;
            }

            // è®¡ç®—æ¯ä¸ªæ•°æ®æºçš„æ€»æ•°æ®é‡å¹¶æ’åº
            const sourceTotals = {};
            for (const [source, trend] of Object.entries(sourceTrends)) {
                sourceTotals[source] = trend.reduce((sum, day) => sum + day.count, 0);
            }

            const sortedSources = Object.entries(sourceTotals)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5);

            const topSources = sortedSources.map(([source]) => source);

            // è·å–æ—¥æœŸæ ‡ç­¾ï¼ˆä½¿ç”¨ç¬¬ä¸€ä¸ªæ•°æ®æºçš„æ—¥æœŸï¼‰
            const firstSource = topSources[0];
            const labels = sourceTrends[firstSource].map(d =>
                new Date(d.date).toLocaleDateString('zh-CN', {month: 'short', day: 'numeric'})
            );

            // é¢œè‰²æ–¹æ¡ˆ
            const colors = [
                {border: '#667eea', bg: 'rgba(102, 126, 234, 0.1)'},
                {border: '#f093fb', bg: 'rgba(240, 147, 251, 0.1)'},
                {border: '#43e97b', bg: 'rgba(67, 233, 123, 0.1)'},
                {border: '#ff6b6b', bg: 'rgba(255, 107, 107, 0.1)'},
                {border: '#feca57', bg: 'rgba(254, 202, 87, 0.1)'}
            ];

            // æ„å»ºæ•°æ®é›†
            const datasets = topSources.map((source, index) => {
                const color = colors[index % colors.length];
                return {
                    label: source.toUpperCase(),
                    data: sourceTrends[source].map(d => d.count),
                    borderColor: color.border,
                    backgroundColor: color.bg,
                    fill: true,
                    tension: 0.4,
                    pointRadius: 3
                };
            });

            // é”€æ¯æ—§å›¾è¡¨
            if (window.sourceTrendChart) {
                window.sourceTrendChart.destroy();
            }

            // åˆ›å»ºæ–°å›¾è¡¨
            window.sourceTrendChart = new Chart(canvas, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                usePointStyle: true,
                                padding: 15
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

        // æ¸²æŸ“å…³é”®è¯è¶‹åŠ¿å›¾
        function renderKeywordTrendChart(keywordTrends) {
            const canvas = document.getElementById('keyword-trend-canvas');
            const container = canvas ? canvas.parentElement : null;
            if (!container) return;

            if (!keywordTrends || Object.keys(keywordTrends).length === 0) {
                container.innerHTML = '<div class="empty-state">æš‚æ— æ•°æ®</div>';
                return;
            }

            // è®¡ç®—æ¯ä¸ªå…³é”®è¯çš„æ€»å‡ºç°æ¬¡æ•°
            const keywordTotals = {};
            for (const [keyword, trend] of Object.entries(keywordTrends)) {
                keywordTotals[keyword] = trend.reduce((sum, day) => sum + day.count, 0);
            }

            // æ’åºå¹¶å–å‰8ä¸ª
            const sortedKeywords = Object.entries(keywordTotals)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 8);

            const maxValue = Math.max(...sortedKeywords.map(k => k[1])) || 1;

            let html = '<div class="simple-chart">';
            sortedKeywords.forEach(([keyword, total]) => {
                const height = (total / maxValue * 200) + 'px';
                html += `
                    <div class="chart-bar">
                        <div class="bar" style="height: ${height}; background: linear-gradient(to top, #ff6b6b 0%, #feca57 100%);">
                            <span class="bar-value">${total}</span>
                        </div>
                        <div class="bar-label">${keyword}</div>
                    </div>
                `;
            });
            html += '</div>';
            container.innerHTML = html;
        }

        // åˆå§‹åŒ–é¡µé¢
        function init() {
            const data = window.REPORT_DATA;
            
            // è®¾ç½®ç”Ÿæˆæ—¶é—´
            document.getElementById('generated-time').textContent = 
                data.generated_at ? new Date(data.generated_at).toLocaleString('zh-CN') : '--';
            
            // è®¾ç½®ç»Ÿè®¡æ•°æ®
            document.getElementById('total-items').textContent = data.total_items || 0;
            document.getElementById('total-sources').textContent = 
                data.sources ? Object.keys(data.sources).length : 0;
            document.getElementById('total-topics').textContent = 
                data.topics ? Object.keys(data.topics).length : 0;
            
            // æ¸²æŸ“å„éƒ¨åˆ†å†…å®¹
            renderOverview(data);
            renderKeywords(data);
            renderTrends(data);
            renderGitHubWeekly(data);
            renderDashboard(data);
            
            // ç»‘å®šå¯¼èˆªTabç‚¹å‡»äº‹ä»¶
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const viewName = this.dataset.view;
                    if (viewName === 'source-detail' || currentView === 'source-detail') {
                        switchView(viewName);
                    } else {
                        switchView(viewName);
                    }
                });
            });
            
            // ç»‘å®šæ•°æ®æºæ ‡ç­¾ç‚¹å‡»äº‹ä»¶
            document.querySelectorAll('.source-tag').forEach(tag => {
                tag.addEventListener('click', function() {
                    const sourceName = this.dataset.source;
                    switchSource(sourceName);
                    // åˆ‡æ¢åˆ°æ•°æ®æºè¯¦æƒ…è§†å›¾
                    switchView('source-detail');
                });
            });
            
            // ç»‘å®šåˆ†ç±»ä¸‹æ‹‰æ¡†äº‹ä»¶
            document.getElementById('source-category').addEventListener('change', function() {
                filterByCategory(this.value);
            });
        }

        // æ¸²æŸ“GitHubæœ¬å‘¨å¢é•¿
        function renderGitHubWeekly(data) {
            const container = document.getElementById('github-weekly-content');
            const sources = data.sources || {};
            const githubItems = sources.github || [];

            if (githubItems.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="emoji">ğŸ“­</div><div>æš‚æ— GitHubæ•°æ®</div></div>';
                return;
            }

            // æŒ‰çƒ­åº¦æ’åº
            const sortedItems = [...githubItems].sort((a, b) => (b.hot_score || 0) - (a.hot_score || 0)).slice(0, 20);

            const html = `
                <div class="github-repo-list">
                    ${sortedItems.map((item, index) => {
                        const extra = item.extra || {};
                        const stars = extra.stars || 0;
                        const forks = extra.forks || 0;
                        const language = extra.language || item.category || 'Unknown';
                        const growth = item.hot_score || 0;

                        return `
                            <div class="github-repo-item">
                                <div class="github-repo-header">
                                    <div class="github-repo-rank">#${index + 1}</div>
                                    <div class="github-repo-info">
                                        <a href="${item.url}" target="_blank" class="github-repo-name">${item.title}</a>
                                        <div class="github-repo-desc">${item.description || 'æš‚æ— æè¿°'}</div>
                                    </div>
                                </div>
                                <div class="github-repo-stats">
                                    <div class="github-repo-stat growth">
                                        <span>ğŸ”¥</span>
                                        <span>+${formatNumber(growth)} æœ¬å‘¨å¢é•¿</span>
                                    </div>
                                    <div class="github-repo-stat stars">
                                        <span>â­</span>
                                        <span>${formatNumber(stars)} Stars</span>
                                    </div>
                                    <div class="github-repo-stat forks">
                                        <span>ğŸ´</span>
                                        <span>${formatNumber(forks)} Forks</span>
                                    </div>
                                    <div class="github-repo-stat language">
                                        <span>ğŸ’»</span>
                                        <span>${language}</span>
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;

            container.innerHTML = html;
        }

        // ä»ªè¡¨ç›˜ç­›é€‰çŠ¶æ€
        let dashboardFilter = 'all';
        let dashboardSort = 'hot';

        // æ¸²æŸ“ä»ªè¡¨ç›˜
        function renderDashboard(data) {
            const sources = data.sources || {};
            
            // æ­£ç¡®åˆå¹¶æ•°æ®ï¼Œç¡®ä¿æ¯ä¸ª item éƒ½æœ‰ source å­—æ®µ
            let allItems = [];
            for (const [sourceName, items] of Object.entries(sources)) {
                if (Array.isArray(items)) {
                    items.forEach(item => {
                        allItems.push({
                            ...item,
                            source: item.source || sourceName
                        });
                    });
                }
            }
            
            // åº”ç”¨ç­›é€‰
            if (dashboardFilter !== 'all') {
                allItems = allItems.filter(item => item.source === dashboardFilter);
            }
            
            // åº”ç”¨æ’åº
            allItems.sort((a, b) => {
                if (dashboardSort === 'hot') return (b.hot_score || 0) - (a.hot_score || 0);
                if (dashboardSort === 'time') return new Date(b.fetched_at) - new Date(a.fetched_at);
                return 0;
            });
            
            // æ›´æ–°æŒ‡æ ‡
            document.getElementById('metric-total').textContent = allItems.length;
            document.getElementById('metric-hot').textContent = new Set(allItems.map(i => i.title)).size;
            document.getElementById('metric-platforms').textContent = new Set(allItems.map(i => i.source)).size;
            
            const maxHeat = allItems.length > 0 ? Math.max(...allItems.map(i => i.hot_score || 0)) : 0;
            document.getElementById('metric-peak').textContent = formatNumber(maxHeat);
            
            if (allItems.length > 0) {
                const latest = new Date(allItems[0].fetched_at);
                document.getElementById('metric-update').textContent = 
                    latest.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' });
            }
            
            const platformColors = {
                'weibo': '#e74c3c', 'douyin': '#000000', 'zhihu': '#3498db',
                'bilibili': '#fb7299', 'github': '#333333', 'hackernews': '#ff6600',
                'arxiv': '#16a085', 'github_ai': '#9b59b6'
            };
            
            const platformNames = {
                'weibo': 'ğŸ“± å¾®åš', 'douyin': 'ğŸµ æŠ–éŸ³', 'zhihu': 'â“ çŸ¥ä¹',
                'bilibili': 'ğŸ“º Bç«™', 'github': 'ğŸ™ GitHub', 'hackernews': 'ğŸ“° HN',
                'arxiv': 'ğŸ“š ArXiv', 'github_ai': 'ğŸ¤– GitHub AI'
            };
            
            // å¹³å°é…ç½® - ä¸ report_layout3.html ä¸€è‡´
            const platformConfig = {
                'weibo': { icon: 'ğŸ“±', color: 'bg-red-500', name: 'å¾®åš' },
                'douyin': { icon: 'ğŸµ', color: 'bg-black', name: 'æŠ–éŸ³' },
                'zhihu': { icon: 'â“', color: 'bg-blue-500', name: 'çŸ¥ä¹' },
                'bilibili': { icon: 'ğŸ“º', color: 'bg-pink-500', name: 'Bç«™' },
                'github': { icon: 'ğŸ™', color: 'bg-gray-800', name: 'GitHub' },
                'hackernews': { icon: 'ğŸ“°', color: 'bg-orange-500', name: 'HN' },
                'arxiv': { icon: 'ğŸ“š', color: 'bg-green-500', name: 'ArXiv' },
                'github_ai': { icon: 'ğŸ¤–', color: 'bg-purple-500', name: 'GitHub AI' }
            };
            
            // å¹³å°åˆ†å¸ƒ
            const platformBars = document.getElementById('platform-bars');
            const platformCounts = {};
            allItems.forEach(item => {
                const source = item.source || 'unknown';
                platformCounts[source] = (platformCounts[source] || 0) + 1;
            });
            
            const total = allItems.length;
            platformBars.innerHTML = Object.entries(platformCounts)
                .sort((a, b) => b[1] - a[1])
                .map(([platform, count]) => {
                    const percent = total > 0 ? (count / total * 100).toFixed(1) : 0;
                    const color = platformColors[platform] || '#95a5a6';
                    const name = platformNames[platform] || platform;
                    return `
                        <div style="margin-bottom: 12px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                                <span style="font-weight: 500;">${name}</span>
                                <span style="color: #666;">${count} (${percent}%)</span>
                            </div>
                            <div style="background: #ecf0f1; height: 8px; border-radius: 4px; overflow: hidden;">
                                <div style="background: ${color}; height: 100%; width: ${percent}%; transition: width 0.5s;"></div>
                            </div>
                        </div>
                    `;
                }).join('');
            
            // çƒ­åº¦è¶‹åŠ¿å›¾ - ä½¿ç”¨çœŸå®æ•°æ®
            const trendChart = document.getElementById('trend-chart');
            const hourlyData = data.trending_by_hour || [];
            
            if (hourlyData.length > 0) {
                // ä½¿ç”¨çœŸå®çš„å°æ—¶è¶‹åŠ¿æ•°æ®
                const maxCount = Math.max(...hourlyData.map(d => d.count), 1);
                trendChart.innerHTML = hourlyData.map(item => {
                    const height = (item.count / maxCount * 100);
                    const timeLabel = item.time ? item.time.split(' ')[1] : '';
                    return `
                        <div style="flex: 1; display: flex; flex-direction: column; align-items: center; gap: 5px;" title="æ•°æ®é‡: ${item.count}, å¹³å‡çƒ­åº¦: ${item.avg_hot_score}">
                            <div style="width: 100%; background: linear-gradient(to top, #3b82f6, #60a5fa); border-radius: 4px 4px 0 0; height: ${height}%; transition: height 0.5s;"></div>
                            <span style="font-size: 0.7em; color: #666;">${timeLabel}</span>
                        </div>
                    `;
                }).join('');
            } else {
                // æ²¡æœ‰æ•°æ®æ—¶æ˜¾ç¤ºæç¤º
                trendChart.innerHTML = '<div style="text-align: center; color: #999; padding: 20px;">æš‚æ— è¶‹åŠ¿æ•°æ®</div>';
            }
            
            // æ´»è·ƒæ—¶æ®µçƒ­åŠ›å›¾ - ä½¿ç”¨çœŸå®æ•°æ®
            const heatmapChart = document.getElementById('heatmap-chart');
            const hourlyDistribution = data.hourly_distribution || [];
            
            if (hourlyDistribution.length > 0) {
                const maxTotalHeat = Math.max(...hourlyDistribution.map(d => d.total_hot_score), 1);
                
                heatmapChart.innerHTML = hourlyDistribution.map((item, i) => {
                    const intensity = item.total_hot_score / maxTotalHeat;
                    const opacity = 0.15 + intensity * 0.85;
                    const timeLabel = `${String(i).padStart(2, '0')}:00`;
                    return `
                        <div style="aspect-ratio: 1; background: #3b82f6; border-radius: 2px; opacity: ${opacity}; cursor: pointer;" 
                             title="${timeLabel} - æ•°æ®é‡: ${item.count}, æ€»çƒ­åº¦: ${Math.round(item.total_hot_score)}, å¹³å‡çƒ­åº¦: ${item.avg_hot_score}"></div>
                    `;
                }).join('');
            } else {
                // æ²¡æœ‰æ•°æ®æ—¶æ˜¾ç¤ºç°è‰²æ ¼å­
                heatmapChart.innerHTML = Array(24).fill(0).map((_, i) => {
                    return `
                        <div style="aspect-ratio: 1; background: #e1e4e8; border-radius: 2px; opacity: 0.3;" title="${String(i).padStart(2, '0')}:00 - æ— æ•°æ®"></div>
                    `;
                }).join('');
            }
        }

        // ä»ªè¡¨ç›˜ç­›é€‰äº‹ä»¶
        document.addEventListener('DOMContentLoaded', function() {
            // ç­›é€‰æŒ‰é’®
            document.querySelectorAll('.dashboard-filter').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.dashboard-filter').forEach(b => {
                        b.style.background = 'white';
                        b.style.color = '#333';
                    });
                    this.style.background = '#3b82f6';
                    this.style.color = 'white';
                    dashboardFilter = this.dataset.filter;
                    if (typeof window.REPORT_DATA !== 'undefined') {
                        renderDashboard(window.REPORT_DATA);
                    }
                });
            });
            
            // æ’åºé€‰æ‹©
            document.getElementById('dashboard-sort').addEventListener('change', function() {
                dashboardSort = this.value;
                if (typeof window.REPORT_DATA !== 'undefined') {
                    renderDashboard(window.REPORT_DATA);
                }
            });
        });

        // ==================== æ•°æ®æºçŠ¶æ€ç®¡ç† ====================
        
        // æ•°æ®æºçŠ¶æ€ç¼“å­˜
        let sourceStatusCache = {};
        let isRefreshing = false;
        
        // è·å–æ•°æ®æºçŠ¶æ€
        async function fetchSourceStatus() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/status`);
                const result = await response.json();
                
                if (result.success && result.data) {
                    sourceStatusCache = result.data.sources || {};
                    renderSourceStatus();
                }
            } catch (error) {
                console.error('è·å–æ•°æ®æºçŠ¶æ€å¤±è´¥:', error);
                // ä½¿ç”¨æŠ¥å‘Šæ•°æ®ä½œä¸ºå¤‡é€‰
                generateStatusFromReport();
            }
        }
        
        // ä»æŠ¥å‘Šæ•°æ®ç”ŸæˆçŠ¶æ€
        function generateStatusFromReport() {
            const data = window.REPORT_DATA;
            if (!data || !data.sources) return;
            
            for (const [source, items] of Object.entries(data.sources)) {
                sourceStatusCache[source] = {
                    success: items.length > 0,
                    item_count: items.length,
                    last_update: data.generated_at,
                    error_message: null,
                    retry_count: 0,
                    status: items.length > 0 ? 'success' : 'unknown'
                };
            }
            
            renderSourceStatus();
        }
        
        // æ¸²æŸ“æ•°æ®æºçŠ¶æ€
        function renderSourceStatus() {
            const grid = document.getElementById('source-status-grid');
            const statusBar = document.getElementById('source-status-bar');
            if (!grid || !statusBar) return;

            // ä»æŠ¥å‘Šæ•°æ®è·å–å®é™…æ•°æ®æƒ…å†µ
            const reportData = window.REPORT_DATA || {};
            const reportSources = reportData.sources || {};

            const statusIcons = {
                'success': 'âœ…',
                'failed': 'âŒ',
                'pending': 'â³',
                'unknown': 'â“'
            };

            const statusClasses = {
                'success': 'success',
                'failed': 'failed',
                'pending': 'pending',
                'unknown': 'unknown'
            };

            let html = '';
            let hasNeedsRefresh = false;

            for (const [source, config] of Object.entries(sourceConfig)) {
                const status = sourceStatusCache[source] || { status: 'unknown', item_count: 0 };

                // è·å–æŠ¥å‘Šä¸­çš„å®é™…æ•°æ®æ¡æ•°
                const reportItems = reportSources[source] || [];
                const hasData = reportItems.length > 0;

                // æ£€æŸ¥æ˜¯å¦éœ€è¦åˆ·æ–° - åªæœ‰å½“çŠ¶æ€å¤±è´¥æˆ–æ²¡æœ‰æ•°æ®æ—¶æ‰éœ€è¦
                const needsRefresh = status.status === 'failed' || !hasData;

                if (needsRefresh) {
                    hasNeedsRefresh = true;
                } else {
                    // æœ‰æ•°æ®çš„æ•°æ®æºä¸æ˜¾ç¤ºåœ¨çŠ¶æ€æ ä¸­
                    continue;
                }

                const icon = statusIcons[status.status] || 'â“';
                const statusClass = statusClasses[status.status] || 'unknown';

                // æ ¼å¼åŒ–æœ€åæ›´æ–°æ—¶é—´
                let timeText = '';
                if (status.last_update) {
                    const date = new Date(status.last_update);
                    const now = new Date();
                    const diff = (now - date) / 1000; // ç§’

                    if (diff < 60) {
                        timeText = 'åˆšåˆš';
                    } else if (diff < 3600) {
                        timeText = `${Math.floor(diff / 60)}åˆ†é’Ÿå‰`;
                    } else if (diff < 86400) {
                        timeText = `${Math.floor(diff / 3600)}å°æ—¶å‰`;
                    } else {
                        timeText = date.toLocaleDateString('zh-CN', { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });
                    }
                } else {
                    timeText = 'æœªçŸ¥';
                }

                // é”™è¯¯ä¿¡æ¯æç¤º
                const errorText = status.error_message ?
                    `<span class="source-status-error" title="${status.error_message}">${status.error_message}</span>` : '';

                // åˆ·æ–°æŒ‰é’®
                const refreshBtn = `<button class="refresh-btn" onclick="refreshSource('${source}')" data-source="${source}">åˆ·æ–°</button>`;

                html += `
                    <div class="source-status-item ${statusClass}">
                        <span class="source-status-icon">${config.icon}</span>
                        <span class="source-status-name">${config.name}</span>
                        <span class="source-status-time">${timeText}</span>
                        ${errorText}
                        ${refreshBtn}
                    </div>
                `;
            }

            grid.innerHTML = html;

            // åªåœ¨æœ‰éœ€è¦åˆ·æ–°çš„æ•°æ®æºæ—¶æ˜¾ç¤ºçŠ¶æ€æ 
            statusBar.style.display = hasNeedsRefresh ? 'block' : 'none';
        }
        
        // åˆ·æ–°å•ä¸ªæ•°æ®æº
        async function refreshSource(source) {
            if (isRefreshing) return;
            
            const btn = document.querySelector(`button[data-source="${source}"]`);
            if (btn) {
                btn.disabled = true;
                btn.textContent = 'åˆ·æ–°ä¸­...';
                btn.classList.add('refreshing');
            }
            
            isRefreshing = true;
            
            try {
                const sourceName = sourceConfig[source]?.name || source;
                showNotification(`æ­£åœ¨åˆ·æ–° ${sourceName}...`, 'info');
                
                console.log(`åˆ·æ–°æ•°æ®æº: ${source}, URL: ${API_BASE_URL}/api/refresh/${source}`);
                
                const response = await fetch(`${API_BASE_URL}/api/refresh/${source}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                console.log(`å“åº”çŠ¶æ€: ${response.status}`);
                
                const result = await response.json();
                console.log('å“åº”ç»“æœ:', result);
                
                if (result.success) {
                    showNotification(`âœ… ${result.message || 'åˆ·æ–°æˆåŠŸ'}`, 'success');
                    // æ›´æ–°çŠ¶æ€
                    await fetchSourceStatus();
                    // åˆ·æ–°é¡µé¢æ•°æ®
                    location.reload();
                } else {
                    showNotification(`âŒ ${result.message || result.error || 'åˆ·æ–°å¤±è´¥'}`, 'error');
                }
            } catch (error) {
                console.error('åˆ·æ–°æ•°æ®æºå¤±è´¥:', error);
                showNotification(`âŒ åˆ·æ–°å¤±è´¥: ${error.message || error}`, 'error');
            } finally {
                isRefreshing = false;
                if (btn) {
                    btn.disabled = false;
                    btn.textContent = 'åˆ·æ–°';
                    btn.classList.remove('refreshing');
                }
            }
        }
        
        // åˆ·æ–°æ‰€æœ‰æ•°æ®æº
        async function refreshAllSources() {
            if (isRefreshing) return;
            
            const btn = document.getElementById('refresh-all-btn');
            if (btn) {
                btn.disabled = true;
                btn.textContent = 'åˆ·æ–°ä¸­...';
            }
            
            isRefreshing = true;
            
            try {
                showNotification('æ­£åœ¨åˆ·æ–°æ‰€æœ‰æ•°æ®æº...', 'info');
                
                const response = await fetch(`${API_BASE_URL}/api/refresh-all`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showNotification('âœ… ' + result.message, 'success');
                    // ç­‰å¾…å‡ ç§’ååˆ·æ–°é¡µé¢
                    setTimeout(() => location.reload(), 3000);
                } else {
                    showNotification('âŒ ' + result.message, 'error');
                }
            } catch (error) {
                console.error('åˆ·æ–°æ‰€æœ‰æ•°æ®æºå¤±è´¥:', error);
                showNotification(`âŒ åˆ·æ–°å¤±è´¥: ${error.message}`, 'error');
            } finally {
                isRefreshing = false;
                if (btn) {
                    btn.disabled = false;
                    btn.textContent = 'åˆ·æ–°å…¨éƒ¨';
                }
            }
        }
        
        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message, type = 'info') {
            // ç§»é™¤ç°æœ‰é€šçŸ¥
            const existing = document.querySelector('.notification');
            if (existing) {
                existing.remove();
            }
            
            // åˆ›å»ºæ–°é€šçŸ¥
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            // 3ç§’åè‡ªåŠ¨ç§»é™¤
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 3000);
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            init();
            
            // åŠ è½½æ•°æ®æºçŠ¶æ€
            fetchSourceStatus();
            
            // æ¯30ç§’åˆ·æ–°ä¸€æ¬¡çŠ¶æ€
            setInterval(fetchSourceStatus, 30000);
        });
    </script>
    <!-- WordCloud2.js è¯äº‘åº“ -->
    <script src="https://cdn.jsdelivr.net/npm/wordcloud@1.2.2/src/wordcloud2.min.js"></script>
    <!-- Chart.js å›¾è¡¨åº“ -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</body>
</html>
